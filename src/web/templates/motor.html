{% extends "base.html" %}

{% block title %}Motor Settings{% endblock %}

{% block content %}
<h1 class="text-xlarge">Motor Settings</h1>
<div class="torque-controls">
    <button onclick="toggleAllTorque(true)" class="btn btn-enable">
        Enable All Torque
    </button>
    <button onclick="toggleAllTorque(false)" class="btn btn-disable">
        Disable All Torque
    </button>
</div>

<div class="motor-grid">
    {% for motor in motors %}
    <div class="motor-box {{ 'enabled' if motor.torque_enabled else 'disabled' }}" data-motor-id="{{ motor.id }}">
        <div class="motor-header">
            <h2 class="motor-name {{ 'enabled' if motor.torque_enabled else 'disabled' }}">
                {{ motor.name }}
            </h2>
            <div class="btn-group">
                <button onclick="toggleTorque({{ motor.id }}, true)" class="btn btn-enable">Enable</button>
                <button onclick="toggleTorque({{ motor.id }}, false)" class="btn btn-disable">Disable</button>
            </div>
        </div>
        <div class="motor-stats">
            <div>Position: <span class="position-value" data-motor-id="{{ motor.id }}">{{ motor.position }}</span>{% if motor.id == 2 %}mm{% else %}°{% endif %}</div>
            <div>Temperature: <span class="temperature-value">{{ motor.temperature }}</span>°C</div>
            <div>Voltage: <span class="voltage-value">{{ motor.voltage }}</span>V</div>
            <div>Current: <span class="current-value">{{ motor.current }}</span>A</div>
            <div>Velocity: <span class="speed-value">{{ motor.speed }}</span> ms</div>
            <div>Acceleration: <span class="load-value">{{ motor.load }}</span> ms</div>
        </div>
        
        <div class="motor-controls">
            <div class="control-group">
                <label for="position_{{ motor.id }}">Position ({% if motor.id == 2 %}mm{% else %}°{% endif %}):</label>
                <input type="number"
                       class="form-control"
                       id="position_{{ motor.id }}"
                       value="{{ motor.position }}"
                       min="{% if motor.id in [3, 4] %}-180{% elif motor.id == 2 %}0{% else %}0{% endif %}"
                       max="{% if motor.id in [3, 4] %}180{% elif motor.id == 2 %}800{% else %}360{% endif %}"
                       step="0.1">
                <button onclick="updateMotorPosition({{ motor.id }})" class="btn">Set</button>
            </div>

            <div class="control-group">
                <label for="velocity_{{ motor.id }}">Velocity (ms):</label>
                <input type="number"
                       class="form-control" 
                       id="velocity_{{ motor.id }}"
                       value="100"
                       min="0"
                       max="32000">
                <button onclick="updateMotorVelocity({{ motor.id }})" class="btn">Set</button>
            </div>

            <div class="control-group">
                <label for="acceleration_{{ motor.id }}">Acceleration (ms):</label>
                <input type="number"
                       class="form-control"
                       id="acceleration_{{ motor.id }}"
                       value="50"
                       min="0"
                       max="32000">
                <button onclick="updateMotorAcceleration({{ motor.id }})" class="btn">Set</button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<script src="/static/main.js"></script>
<script>
// Initialize position inputs with converted values
document.addEventListener('DOMContentLoaded', function() {
    {% for motor in motors %}
        const position{{ motor.id }} = stepsToUnits({{ motor.position }}, {{ motor.id }});
        const input{{ motor.id }} = document.getElementById('position_{{ motor.id }}');
        if (input{{ motor.id }}) {
            input{{ motor.id }}.value = position{{ motor.id }};
        }
        const display{{ motor.id }} = document.querySelector('.position-value[data-motor-id="{{ motor.id }}"]');
        if (display{{ motor.id }}) {
            display{{ motor.id }}.textContent = position{{ motor.id }};
        }
    {% endfor %}
});
</script>
{% endblock %}
